################################################################################
# options

run-shell "tmux set -g @script_home $(dirname $(readlink -f ~/.tmux.conf))"

set -g base-index 1
set -g display-time 1000
set -g repeat-time 750

################################################################################
# common

unbind-key -a
#unbind-key -a -T copy-mode
unbind-key -a -T copy-mode-vi

# set C-b as primary prefix
set -g prefix C-b
bind-key    -T prefix : command-prompt
bind-key    -T prefix C-b send-prefix

# set C-a as secondary prefix
bind-key    -T root C-a switch-client -T prefix2
bind-key    -T prefix2 C-a send-keys C-a

################################################################################
# debug
bind-key    -T prefix escape source ~/.tmux.conf \; display "reload ~.tmux.conf"

################################################################################
# session
bind-key    -T prefix d detach-client
bind-key    -T prefix D choose-client -Z
bind-key    -T prefix s choose-tree -Zs

################################################################################
# window
bind-key    -T prefix c new-window
bind-key    -T prefix 0 select-window -t :=0
bind-key    -T prefix 1 select-window -t :=1
bind-key    -T prefix 2 select-window -t :=2
bind-key    -T prefix 3 select-window -t :=3
bind-key    -T prefix 4 select-window -t :=4
bind-key    -T prefix 5 select-window -t :=5
bind-key    -T prefix 6 select-window -t :=6
bind-key    -T prefix 7 select-window -t :=7
bind-key    -T prefix 8 select-window -t :=8
bind-key    -T prefix 9 select-window -t :=9
bind-key    -T prefix tab select-window -l

bind-key    -T prefix , command-prompt -I "#W" "rename-window -- '%%'"
bind-key    -T prefix . command-prompt "move-window -t '%%'"

################################################################################
# panel
bind-key -r -T prefix up select-pane -U
bind-key -r -T prefix down select-pane -D
bind-key -r -T prefix left select-pane -L
bind-key -r -T prefix right select-pane -R

bind-key    -T prefix '|' run-shell "#{@script_home}/new-column.sh"
bind-key    -T prefix '-' split-window -v
bind-key    -T prefix 'z' resize-pane -Z

bind-key    -T prefix k confirm-before -p "kill-pane #P? (y/n)" kill-pane

bind-key    -T prefix m select-pane -m
bind-key    -T prefix space swap-pane \; \
                            select-pane -t {marked} \; select-pane -M

bind-key -r -T prefix2 up resize-pane -U 3
bind-key -r -T prefix2 down resize-pane -D 3
bind-key -r -T prefix2 left resize-pane -L 5
bind-key -r -T prefix2 right resize-pane -R 5
bind-key -r -T prefix2 C-up resize-pane -U
bind-key -r -T prefix2 C-down resize-pane -D
bind-key -r -T prefix2 C-left resize-pane -L
bind-key -r -T prefix2 C-right resize-pane -R

bind-key -r -T prefix2 '+' run-shell "#{@script_home}/enlarge-pane.sh 3"
bind-key -r -T prefix2 '=' run-shell "#{@script_home}/enlarge-pane.sh 3"
bind-key -r -T prefix2 '-' run-shell "#{@script_home}/enlarge-pane.sh -3"

################################################################################
# copy paste
set -g mode-keys vi
bind-key    -T prefix pageup copy-mode -eu
bind-key    -T prefix v copy-mode
bind-key    -T prefix p run "xclip -o -sel clip | tmux load-buffer -" \; paste-buffer
bind-key    -T prefix P run "xclip -o -sel pri | tmux load-buffer -" \; paste-buffer

bind-key    -T copy-mode-vi up send-keys -X cursor-up
bind-key    -T copy-mode-vi down send-keys -X cursor-down
bind-key    -T copy-mode-vi left send-keys -X cursor-left
bind-key    -T copy-mode-vi right send-keys -X cursor-right

bind-key    -T copy-mode-vi h send-keys -X cursor-left
bind-key    -T copy-mode-vi j send-keys -X cursor-down
bind-key    -T copy-mode-vi k send-keys -X cursor-up
bind-key    -T copy-mode-vi l send-keys -X cursor-right

bind-key    -T copy-mode-vi w send-keys -X next-word
bind-key    -T copy-mode-vi b send-keys -X previous-word

bind-key    -T copy-mode-vi pageup send-keys -X page-up
bind-key    -T copy-mode-vi pagedown send-keys -X page-down

bind-key    -T copy-mode-vi q send-keys -X cancel
bind-key    -T copy-mode-vi v if-shell -F "#{rectangle_toggle}" 'send-keys -X rectangle-toggle; send-keys -X begin-selection' 'send-keys -X begin-selection'
bind-key    -T copy-mode-vi V send-keys -X select-line
bind-key    -T copy-mode-vi C-v if-shell -F "#{rectangle_toggle}" 'send-keys -X begin-selection' 'send-keys -X rectangle-toggle; send-keys -X begin-selection'
bind-key    -T copy-mode-vi y send-keys -X copy-selection-and-cancel \; run-shell -b "tmux save-buf - | xclip -sel clip"

bind-key    -T copy-mode-vi WheelUpPane select-pane \; send-keys -X -N 5 scroll-up
bind-key    -T copy-mode-vi WheelDownPane select-pane \; send-keys -X -N 5 scroll-down

bind-key    -T copy-mode-vi MouseDrag1Pane select-pane \; send-keys -X begin-selection

bind-key    -T copy-mode-vi MouseDown3Pane select-pane \; send-keys -X copy-selection-and-cancel \; run-shell -b "tmux save-buf - | xclip -sel clip"

################################################################################
# mouse
set -g mouse on
bind-key    -T root MouseDown1Pane \
    if-shell "tmux display -t {marked} -p" \
        "swap-pane -s {mouse} -t {marked}; select-pane -M" \
        "select-pane -t {mouse} ; send-keys -M"
bind-key    -T root MouseDrag1Pane if-shell -F "#{?pane_in_mode,1,#{mouse_any_flag}}" "send-keys -M" "copy-mode -M"
bind-key    -T root MouseDown1Status select-window -t {mouse}
bind-key    -T root MouseDrag1Border resize-pane -M

bind-key    -T root MouseDown2Pane if-shell -F "#{?pane_in_mode,1,#{mouse_any_flag}}" "send-keys -M" "run \"xclip -o -sel pri | tmux load-buffer -\" ; paste-buffer"

bind-key    -T root MouseDown3Pane select-pane -m -t {mouse}

bind-key    -T root WheelUpPane select-pane -t "{mouse}" \; if-shell "#{@script_home}/translate-wheel.sh up" "" "send-keys -M"
bind-key    -T root WheelDownPane select-pane -t "{mouse}" \; if-shell "#{@script_home}/translate-wheel.sh down" "" "send-keys -M"

